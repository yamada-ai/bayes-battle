# 状態異常（第4世代）

**参照元**: ポケモンwiki, Bulbapedia
**対象世代**: 第4世代（ダイヤモンド・パール・プラチナ・ハートゴールド・ソウルシルバー）

---

## 状態異常の基本

### 状態異常の種類

第4世代では以下の5種類の状態異常が存在：

1. **まひ**（Paralysis）
2. **やけど**（Burn）
3. **どく**（Poison）
4. **もうどく**（Badly Poisoned）
5. **こおり**（Freeze）
6. **ねむり**（Sleep）

### 基本ルール

- 1匹のポケモンは**1つの状態異常のみ**を持つ
- 状態異常は**交代しても継続**する
- 一部の技・道具・特性で回復可能

---

## 1. まひ（Paralysis）

### 効果

1. **素早さ低下**: 素早さが**1/4**になる（×0.25）
2. **行動不能**: 行動時に**25%の確率**で技が出せない（「しびれて動けない！」）

### 付与方法

- でんじは（命中90、電気タイプ無効）
- 電気技の追加効果（10まんボルト10%、かみなり30%等）
- 接触技使用時の特性（せいでんき30%）

### 回復方法

- ラムのみ/カゴのみ
- なおす/いやしのすず
- 自然回復はしない

### 特殊ケース

- **マジックガード**: 行動不能は発生するが、素早さ低下は無視される
- **ふしぎなうろこ**: まひ状態で防御が1.5倍

---

## 2. やけど（Burn）

### 効果

1. **物理技威力半減**: 物理技のダメージが**×0.5**になる
2. **ターン終了時ダメージ**: 最大HPの**1/8**

### ダメージ発生タイミング

**ターン終了時**（全てのポケモンの行動後）

### 付与方法

- おにび（命中75）
- 炎技の追加効果（かえんほうしゃ10%、だいもんじ10%等）
- 接触技使用時の特性（ほのおのからだ30%）

### 回復方法

- ラムのみ/カゴのみ/オレンのみ
- なおす/いやしのすず

### 特殊ケース

- **こんじょう**: やけど状態で攻撃×1.5、物理技威力半減を無効化
- **ねつぼうそう**: やけど状態で特攻×1.5

---

## 3. どく（Poison）

### 効果

- **ターン終了時ダメージ**: 最大HPの**1/8**

### ダメージ発生タイミング

**ターン終了時**（全てのポケモンの行動後）

### 付与方法

- どくどく（必中、毒/鋼タイプ無効）
- 毒技の追加効果（ヘドロばくだん30%等）
- 接触技使用時の特性（どくのトゲ30%）

### 回復方法

- ラムのみ/カゴのみ/モモンのみ
- なおす/いやしのすず

### 特殊ケース

- **ポイズンヒール**: どく状態で毎ターン1/8回復（ダメージ無効）
- **どくぼうそう**: どく状態で攻撃×1.5

---

## 4. もうどく（Badly Poisoned）

### 効果

- **累積ダメージ**: ターン経過で増加するダメージ
  - 1ターン目：最大HPの 1/16
  - 2ターン目：最大HPの 2/16
  - 3ターン目：最大HPの 3/16
  - ...
  - 最大：最大HPの 15/16

### ダメージ発生タイミング

**ターン終了時**（全てのポケモンの行動後）

### カウンターのリセット

- **交代するとカウンターリセット**（次に出た時は1/16から）
- ただし、もうどく状態自体は継続

### 付与方法

- どくどく（必中、毒タイプが使うと必中）
- どくびし2枚設置後の交代

### 回復方法

- 通常のどくと同じ（ラムのみ/モモンのみ等）

---

## 5. こおり（Freeze）

### 効果

- **完全に行動不能**（技が出せない）
- **20%の確率で自然解除**（各ターン開始時）

### 解除判定のタイミング

行動前（ターン開始時）

### 付与方法

- 氷技の追加効果（れいとうビーム10%、ふぶき10%等）
- トライアタック（3種の状態異常を各6.67%）

### 即座に解除される条件

- 炎技を受ける
- フレアドライブ等の炎技を使用しようとする

### 回復方法

- ラムのみ/カゴのみ/アスピのみ
- なおす/いやしのすず
- 上記の即座解除条件

### 特殊ケース

- **マグマのよろい**: こおり状態にならない

---

## 6. ねむり（Sleep）

### 効果

- **行動不能**（技が出せない）
- **例外**: ねごと/いびき は使用可能

### 睡眠ターン数

**2〜5ターン**（ランダム）

### カウントの仕組み

1. ねむり状態になったターンは**カウント0**
2. 次のターンからカウント開始
3. カウントが睡眠ターン数に達すると目覚める

**例**：
- 睡眠ターン数3の場合
  - ターン1: ねむり付与（カウント0）
  - ターン2: ねむり（カウント1）
  - ターン3: ねむり（カウント2）
  - ターン4: ねむり（カウント3）→ 目覚める

### 付与方法

- ねむり技（さいみんじゅつ60、くさぶえ55、うたう55等）
- キノコのほうし（命中100、草タイプ以外）
- あくび（次のターン終了時にねむり）

### 回復方法

- ラムのみ/カゴのみ/クラボのみ
- なおす/いやしのすず
- 自然目覚め（ターン経過）

### 特殊ケース

- **ふみん/やるき**: ねむり状態にならない
- **はやおき**: 睡眠ターン数が半分になる

---

## 状態異常の優先順位

複数の状態異常付与が同時に起こる場合（通常は起こらないが、特殊ケース）：

```
既存の状態異常は上書きされない
```

---

## ターン終了時のダメージ処理順序

ターン終了時に複数のダメージ源がある場合、以下の順序で処理：

```
1. 天候ダメージ（すなあらし/あられ）
2. 状態異常ダメージ（やけど/どく/もうどく）
3. 呪いのダメージ
4. 宿り木のダメージ
5. 黒いヘドロ（毒タイプ以外）
6. 拘束技のダメージ（まきつく等）
7. 悪夢のダメージ
```

**詳細は [`turn-order.md`](./turn-order.md) のターン終了処理を参照。**

---

## 実装例：状態異常の付与

```typescript
function tryInflictStatus(
  target: Pokemon,
  status: StatusCondition,
  rng: RNG
): boolean {
  // 既に状態異常がある場合は失敗
  if (target.status !== null) {
    return false;
  }

  // タイプ免疫チェック
  if (isImmuneToStatus(target, status)) {
    return false;
  }

  // 特性免疫チェック
  if (hasStatusImmunity(target, status)) {
    return false;
  }

  // 状態異常付与
  target.status = status;

  // 睡眠の場合、ターン数を決定
  if (status === StatusCondition.SLEEP) {
    target.sleepTurns = rng.nextInt(2, 5);
    target.sleepCounter = 0;
  }

  // もうどくの場合、カウンター初期化
  if (status === StatusCondition.BADLY_POISONED) {
    target.toxicCounter = 1;
  }

  return true;
}
```

---

## 実装例：状態異常の効果適用

```typescript
function applyStatusEffects(pokemon: Pokemon): void {
  if (pokemon.status === null) return;

  switch (pokemon.status) {
    case StatusCondition.BURN:
      // ターン終了時に1/8ダメージ
      applyDamage(pokemon, Math.floor(pokemon.maxHP / 8));
      break;

    case StatusCondition.POISON:
      // ターン終了時に1/8ダメージ
      applyDamage(pokemon, Math.floor(pokemon.maxHP / 8));
      break;

    case StatusCondition.BADLY_POISONED:
      // 累積ダメージ
      const toxicDamage = Math.floor((pokemon.maxHP * pokemon.toxicCounter) / 16);
      applyDamage(pokemon, toxicDamage);
      pokemon.toxicCounter++;
      break;

    // ... 他の状態異常
  }
}
```

---

## テストケース

### ケース1：まひの素早さ低下

- 元の素早さ：100
- まひ状態
- **期待値**: 実効素早さ = 25

### ケース2：やけどのダメージ

- 最大HP：200
- やけど状態
- **期待値**: ターン終了時に25ダメージ

### ケース3：もうどくの累積

- 最大HP：160
- もうどく状態
- **期待値**:
  - 1ターン目終了：10ダメージ (160/16)
  - 2ターン目終了：20ダメージ (160×2/16)
  - 3ターン目終了：30ダメージ (160×3/16)

### ケース4：こおりの自然解除

- こおり状態
- 各ターン20%で解除
- **期待値**: 平均5ターンで解除

### ケース5：ねむりのターン数

- ねむり状態（睡眠ターン数3）
- **期待値**: 4ターン後に目覚める

---

## イベントログ

以下のイベントを生成：

- `STATUS_INFLICT`: 状態異常付与
- `STATUS_CURE`: 状態異常回復
- `STATUS_PREVENT_ACTION`: まひ/ねむり/こおりで行動不能
- `STATUS_DAMAGE`: やけど/どく/もうどくのダメージ
- `FREEZE_THAW`: こおり解除
- `SLEEP_WAKE`: ねむりから目覚め

---

## 参考文献

- [ポケモンwiki - 状態異常](https://wiki.xn--rckteqa2e.com/wiki/%E7%8A%B6%E6%85%8B%E7%95%B0%E5%B8%B8)
- [Bulbapedia - Status condition](https://bulbapedia.bulbagarden.net/wiki/Status_condition)
- [Bulbapedia - Paralysis](https://bulbapedia.bulbagarden.net/wiki/Paralysis)
- [Bulbapedia - Burn](https://bulbapedia.bulbagarden.net/wiki/Burn)
- [Bulbapedia - Poison](https://bulbapedia.bulbagarden.net/wiki/Poison_(status_condition))
- [Bulbapedia - Freeze](https://bulbapedia.bulbagarden.net/wiki/Freeze)
- [Bulbapedia - Sleep](https://bulbapedia.bulbagarden.net/wiki/Sleep_(status_condition))
